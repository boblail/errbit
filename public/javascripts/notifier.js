var Hoptoad={VERSION:"0.1.1",NOTICE_XML:'<?xml version="1.0" encoding="UTF-8"?><notice version="2.0"><api-key></api-key><notifier><name>hoptoad_notifier_js</name><version>2.0</version><url>http://hoptoadapp.com</url></notifier><error><class>EXCEPTION_CLASS</class><message>EXCEPTION_MESSAGE</message><backtrace>BACKTRACE_LINES</backtrace></error><request><url>REQUEST_URL</url><component>REQUEST_COMPONENT</component><action>REQUEST_ACTION</action></request><server-environment><project-root>PROJECT_ROOT</project-root><environment-name>production</environment-name></server-environment></notice>',
ROOT:window.location.protocol+"//"+window.location.host,BACKTRACE_MATCHER:/^(.*)\@(.*)\:(\d+)$/,backtrace_filters:[/notifier\.js/],setEnvironment:function(a){Hoptoad.NOTICE_XML=Hoptoad.NOTICE_XML.replace(/<environment-name>.*<\/environment-name>/,"<environment-name>"+a+"</environment-name>")},setHost:function(a){Hoptoad.host=a},setKey:function(a){Hoptoad.NOTICE_XML=Hoptoad.NOTICE_XML.replace(/<api-key>.*<\/api-key>/,"<api-key>"+a+"</api-key>")},setErrorDefaults:function(a){Hoptoad.errorDefaults=a},
notify:function(a){a=escape(Hoptoad.generateXML(a));a=Hoptoad.host+"/notifier_api/v2/notices.xml?data="+a;var d=document.createElement("iframe");d.style.width="1px";d.style.height="1px";d.style.display="none";d.src=a;document.getElementsByTagName("head")[0].appendChild(d)},generateXML:function(a){a=Hoptoad.normalizeError(a);var d=Hoptoad.NOTICE_XML.replace("PROJECT_ROOT",Hoptoad.ROOT).replace("EXCEPTION_CLASS",Hoptoad.escapeText(a.type)).replace("EXCEPTION_MESSAGE",Hoptoad.escapeText(a.message));
d=Hoptoad.fillInRequest(d,a);return d=Hoptoad.fillInBacktrace(d,a)},normalizeError:function(a){a=a||{};a=Hoptoad.mergeDefault(Hoptoad.errorDefaults,a);a.type=a.type||a.name||"Error";a.message=a.message||"Unknown error.";a.url=a.url||"";a.component=a.component||a.controller_name||"";a.action=a.action||a.action_name||"";a["cgi-data"]=a["cgi-data"]||{};a["cgi-data"].HTTP_USER_AGENT=navigator.userAgent;return a},fillInRequest:function(a,d){var f=Hoptoad.escapeText(d.url),k=Hoptoad.escapeText(d.component),
o=Hoptoad.escapeText(d.action);return Hoptoad.trim(f)==""&&Hoptoad.trim(k)==""?Hoptoad.eraseRequest(a):Hoptoad.fillInRequestWith(a,d,f,o,k)},eraseRequest:function(a){return a.replace(/<request>.*<\/request>/,"")},fillInRequestWith:function(a,d,f,k,o){return a.replace("</request>",Hoptoad.generateData(d)+"</request>").replace("REQUEST_URL",f).replace("REQUEST_ACTION",k).replace("REQUEST_COMPONENT",o)},generateData:function(a){for(var d="",f=["cgi-data","params","session"],k=0,o=f.length;k<o;k++){var q=
f[k];if(a[q]){d+="<"+q+">";d+=Hoptoad.generateVariables(a[q]);d+="</"+q+">"}}return d},generateVariables:function(a){var d,f="";for(d in a)f+='<var key="'+Hoptoad.escapeText(d)+'">'+Hoptoad.escapeText(a[d])+"</var>";return f},fillInBacktrace:function(a,d){var f=Hoptoad.generateBacktrace(d);return a.replace("BACKTRACE_LINES",f.join(""))},generateBacktrace:function(a){var d=[],f=CrashKit.computeStackTrace(a);a=f.stack;if(f.mode!="failed")for(var k=0,o=a.length;k<o;k++){f=a[k];Hoptoad.validBacktraceLine(f.url)&&
d.push(Hoptoad.generateLine(f.func,f.url,f.line))}return d},validBacktraceLine:function(a){for(var d=0;d<Hoptoad.backtrace_filters.length;d++)if(a.match(Hoptoad.backtrace_filters[d]))return false;return true},generateLine:function(a,d,f){return'<line method="'+a+'" file="'+d+'" number="'+f+'" />'},escapeText:function(a){return a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/'/g,"&#39;").replace(/"/g,"&#34;")},trim:function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,
"")},mergeDefault:function(a,d){var f={},k;for(k in d)f[k]=d[k];for(k in a)f.hasOwnProperty(k)||(f[k]=a[k]);return f}},CrashKit={};
CrashKit.computeStackTrace=function(){var a={};if(typeof XMLHttpRequest=="undefined")XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(h){}throw Error("This browser does not support XMLHttpRequest.");};var d=function(b){if(!(b in a)){var c;try{var e=new XMLHttpRequest;e.open("GET",b,false);
e.send("");c=e.responseText}catch(h){c=""}a[b]=c.split.call(c,"\n")}return a[b]},f=function(b,c){var e;a:{e=d(b);for(var h=/function ([^(]*)\(([^)]*)\)/,g=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,i="",l=0;l<10;++l){i=e[c-l]+i;if(i!==undefined){var j=g.exec(i);if(j){e=j[1];break a}else j=h.exec(i);if(j&&j[1]){e=j[1];break a}}}e="?"}return e},k=function(b,c){var e=d(b),h=[],g=false;c-=1;for(var i=c-2;i<=c+2;i++){var l=e[i];if(typeof l!="undefined")g=true;h.push(l)}return g?
h:null},o=function(b){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return b.replace(arguments.callee.sRE,"\\$1")},q=function(b){return o(b).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")},u=function(b,c,e){for(var h in c){var g=d(c[h]);if(g){g=g.join("\n");var i=b.exec(g);if(i){b={url:c[h],line:null};b.startLine=g.substring(0,i.index).split("\n").length;
if(e)b.line=b.startLine;return b}}}return null},A=function(b){for(var c=[window.location.href],e=document.getElementsByTagName("script"),h=0;h<e.length;h++){var g=e[h];g.src&&c.push(g.src)}b=""+b;h=false;if(/^function(?:\s+([\w$]+))?\s*\(([\w\s,]+)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.test(b)){g=RegExp.$1;var i=RegExp.$2;e=RegExp.$3;i=i.split(",").join("\\s*,\\s*");g=g?"\\s+"+g:"";h=e.split("\n").length==1;e=o(e).replace(/;$/,";?").replace(/\s+/g,"\\s+");g=RegExp("function"+g+"\\s*\\("+i+"\\)\\s*{\\s*"+
e+"\\s*}")}else g=RegExp(o(b));if(h=u(g,c,h))return h;if(/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/.test(b)){h=RegExp.$1;e=RegExp.$2;e=q(e);g=RegExp("on"+h+"=[\\'\"]\\s*"+e+"\\s*[\\'\"]","i");if(h=u(g,c,true))return h;g=RegExp(e);if(h=u(g,c,true))return h}window.console&&console.info("Function code not found in HTML and all SCRIPTs (please contact CrashKit support):\n"+b);return null},w=function(b,c,e){c={url:c,line:e};if(c.url&&c.line){b.incomplete=false;if(!c.func)c.func=f(c.url,
c.line);if(!c.context)c.context=k(c.url,c.line);if(b.stack.length>0)if(b.stack[0].url==c.url)if(b.stack[0].line==c.line)return;else if(!b.stack[0].line&&b.stack[0].func==c.func){b.stack[0].line=c.line;b.stack[0].context=c.context;return}b.stack.splice(0,0,c);return b.partial=true}else b.incomplete=true},B=function(b,c){for(var e=/function\s*([\w\-$]+)?\s*\(/i,h=[],g={},i=false,l=arguments.callee.caller;l&&!i;l=l.caller){var j=l.name||"";j||(j=e.test(l.toString())?RegExp.$1||"":"");i=A(l);var v=null,
n=null;if(i){v=i.url;n=i.line;j||(j=f(v,i.startLine))}i=!!g[l];g[l]=true;j={url:v,func:j,line:n};if(i)j.recursion=true;h.push(j)}h.splice(0,c);e={mode:"callers",name:b.name,message:b.message,stack:h};w(e,b.sourceURL||b.fileName,b.line||b.lineNumber);return e},s=function(b,c){var e=null;c=typeof c=="undefined"?0:c-0;try{if(b.stack){var h=/^\s*(?:(\w*)\(.*\))?@((?:file|http).*):(\d+)\s*$/i,g=b.stack.split("\n"),i=[],l;for(l in g)if(h.test(g[l])){var j={url:RegExp.$2,func:RegExp.$1,line:RegExp.$3};if(!j.func&&
j.line)j.func=f(j.url,j.line);if(j.line)j.context=k(j.url,j.line);i.push(j)}e=i.length?{mode:"firefox",name:b.name,message:b.message,stack:i}:null}else e=null;if(e)return e}catch(v){}try{var n=b.message.split("\n");if(n.length<4)e=null;else{h=/^\s*Line (\d+) of linked script ((?:file|http)\S+)(?:: in function (\S+))?\s*$/i;g=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|http)\S+)(?:: in function (\S+))?\s*$/i;i=/^\s*Line (\d+) of function script\s*$/i;l=[];var m=document.getElementsByTagName("script");
j=[];for(var p in m)m[p].src||j.push(m[p]);p=2;for(var C=n.length;p<C;p+=2){m=null;if(h.test(n[p]))m={url:RegExp.$2,func:RegExp.$3,line:RegExp.$1};else if(g.test(n[p])){m={url:RegExp.$3,func:RegExp.$4};var D=RegExp.$1-0,x=j[RegExp.$2-1];if(x){var r=d(m.url);if(r){r=r.join("\n");var y=r.indexOf(x.innerText);if(y>=0)m.line=D+r.substring(0,y).split("\n").length}}}else if(i.test(n[p])){var z=window.location.href.replace(/#.*$/,""),E=RegExp(q(n[p+1]));if(r=u(E,[z],true))m={url:z,line:r.line,func:""}}if(m){if(!m.func)m.func=
f(m.url,m.line);var t=k(m.url,m.line),F=t?t[Math.floor(t.length/2)]:null;m.context=t&&F.replace(/^\s*/,"")==n[p+1].replace(/^\s*/,"")?t:[n[p+1]];l.push(m)}}e=l.length?{mode:"opera",name:b.name,message:n[0],stack:l}:null}if(e)return e}catch(G){}try{if(e=B(b,c+1))return e}catch(H){}return{mode:"failed"}};s.augmentStackTraceWithInitialElement=w;s.guessFunctionName=f;s.gatherContext=k;s.ofCaller=function(b){b=(typeof b=="undefined"?0:b-0)+1;try{0()}catch(c){return s(c,b+1)}};return s}();
window.onerror=function(a,d,f){setTimeout(function(){Hoptoad.notify({message:a,stack:"@"+d+":"+f})},100);return true};
